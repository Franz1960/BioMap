@page "/Lists/Log"
@inject Microsoft.Extensions.Localization.IStringLocalizer<App> Localize
@inject DataService DS
@inject SessionData SD
@inject IJSRuntime JSRuntime
@using BioMap

<FilterSettings FilteringTarget="@Filters.FilteringTargetEnum.Log" />

<h1>@Localize["Log"]</h1>

<table class="table table-striped table-sm">
  <thead>
    <tr>
      <th scope="col">@Localize["Time"]</th>
      <th scope="col">@Localize["User"]</th>
      <th scope="col">@Localize["Action"]</th>
    </tr>
  </thead>
  <tbody>
    @foreach (var le in LogEntries) {
      <tr>
        <td>@le.CreationTime.ToString("yyyy-MM-dd HH:mm:ss")</td>
        <td>@le.User</td>
        <td>@le.Action</td>
      </tr>
    }
  </tbody>
</table>

@code {
  private int i = 0;
  private LogEntry[] LogEntries = new LogEntry[0];
  protected override void OnInitialized() {
    base.OnInitialized();
    SD.Filters.FilterChanged+=(sender,ev) => {
      RefreshData();
      base.InvokeAsync(StateHasChanged);
    };
    RefreshData();
  }
  private void RefreshData() {
    this.LogEntries = DataService.Instance.GetLogEntries(SD.Filters,"dt>'2018-08-01'","log.dt DESC");
  }
}
