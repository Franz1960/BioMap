@page "/Pictures/IdCards"
@inject Microsoft.Extensions.Localization.IStringLocalizer<App> Localize
@inject DataService DS
@inject SessionData SD
@inject IJSRuntime JSRuntime
@using BioMap

<FilterSettings FilteringTarget="@Filters.FilteringTargetEnum.Individuals" />

<h1>@Localize["ID Cards"]</h1>

<PhotoPopup @ref="PhotoPopup1" />

<div class="row">
  @foreach (var el in Elements)
  {
    <div class="card" style="width: 240px;">
      <a href="javascript:void(0);" @onclick="()=>OnSelectClick(el)">
        <img class="card-img-top" src="api/photos/@el.ElementName?maxdim=240&Project=@SD.CurrentUser.Project" style="max-width:100%;max-height:100%;margin-top:1px;" />
      </a>
      <div class="card-footer">
        <small><b>@el.GetIId()</b> (@el.GetIsoDate()/@el.Gender/@el.GetHeadBodyLengthMm().ToString("0.0")/@el.GetPlaceName())</small>
      </div>
    </div>
  }
</div>

@code {
  private Element[] Elements = new Element[0];
  private PhotoPopup PhotoPopup1;
  protected override void OnInitialized()
  {
    base.OnInitialized();
    SD.Filters.FilterChanged += (sender, ev) =>
    {
      RefreshData();
      base.InvokeAsync(this.StateHasChanged);
    };
    RefreshData();
  }
  private void RefreshData()
  {
    this.Elements = DataService.Instance.GetElements(SD, SD.Filters, WhereClauses.Is_Individuum, "indivdata.iid ASC,elements.creationtime ASC");
  }
  private void OnSelectClick(Element el)
  {
    this.PhotoPopup1.Show(el);
  }
}
