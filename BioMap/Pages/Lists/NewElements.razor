@page "/Lists/NewElements"
@inject Microsoft.Extensions.Localization.IStringLocalizer<App> Localize
@inject DataService DS
@inject SessionData SD
@inject IJSRuntime JSRuntime
@using BioMap

@if (elementToMeasure!=null) {
  <Row Margin="Margin.Is1.OnY">
    <Column>
      <Image Style="max-width:100%;" Source="@("api/photos/"+elementToMeasure.ElementName+"?Project="+@SD.CurrentUser.Project)"/>
    </Column>
    <Column ColumnSize="ColumnSize.Is2">
    </Column>
  </Row>
} else if (elementToMeasure!=null) {
  <Row Margin="Margin.Is1.OnY">
    <Column>
    </Column>
  </Row>
}
<Row Margin="Margin.Is1.OnY">
  <Column>
    <Table Class="table-striped table-sm">
      <TableHeader>
        <TableRow>
          <TableHeaderCell Style="width:18%;">
            @Localize["Place"]
          </TableHeaderCell>
          <TableHeaderCell Style="width:15%;">
            @Localize["Time"]
          </TableHeaderCell>
          <TableHeaderCell Style="width:25%;">
            @Localize["Name"]
          </TableHeaderCell>
          <TableHeaderCell>
            @Localize["Image"]
          </TableHeaderCell>
          <TableHeaderCell>
            @Localize["Action"]
          </TableHeaderCell>
          <TableHeaderCell>
            @Localize["User"]
          </TableHeaderCell>
        </TableRow>
      </TableHeader>
      <TableBody>
        @foreach (var el in Elements) {
          <TableRow Background="@((elementToMeasure==el || elementToIdentify==el)?Background.Primary:Background.None)">
            <TableRowCell>
              @el.GetPlaceName()
            </TableRowCell>
            <TableRowCell>
              @el.GetIsoDateTime()
            </TableRowCell>
            <TableRowCell>
              <a href="javascript:void(0);" @onclick="()=>OnSelectClick(el)">@el.ElementName</a>
            </TableRowCell>
            <TableRowCell>
              @if (el.HasPhotoData()) {
                <a href="javascript:void(0);" @onclick="()=>OnSelectClick(el)">
                  <Figure Size="FigureSize.Is96x96">
                    <FigureImage Source="@("api/photos/"+@el.ElementName+"?maxdim=96&Project="+@SD.CurrentUser.Project)" AlternateText="@el.ElementName" />
                  </Figure>
                </a>
              }
            </TableRowCell>
            <TableRowCell>
              <Button Color="Color.Light" Disabled="@(!SD.CurrentUser.MayChangeElements)" Clicked="@(async (e)=>{ await Measure_Clicked(el); })">
                <Icon Name="IconName.Crop"></Icon>
                @Localize["Measure#To_measure_length"]
              </Button>
              <Button Color="Color.Light" Disabled="@(!SD.CurrentUser.MayChangeElements)" Clicked="@(async (e)=>{ await Identify_Clicked(el); })">
                <Icon Name="IconName.IdCard"></Icon>
                @Localize["Identify"]
              </Button>
            </TableRowCell>
            <TableRowCell>
              @el.ElementProp.UploadInfo.UserId
              <Button Float="Float.Right" Color="Color.Light" Disabled="!SD.CurrentUser.MayDeleteElement(el)" Clicked="@(async (e)=>{ await DeleteElement(el); })">
                <Icon Name="IconName.Delete"></Icon>
              </Button>
            </TableRowCell>
          </TableRow>
        }
      </TableBody>
    </Table>
  </Column>
</Row>

<PhotoPopup @ref="PhotoPopup1" />
